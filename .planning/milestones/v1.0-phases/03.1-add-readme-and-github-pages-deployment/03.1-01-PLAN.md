---
phase: 03.1-add-readme-and-github-pages-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - index.html
  - .github/workflows/deploy.yml
autonomous: true

must_haves:
  truths:
    - "Production build assets use /webfaulon/ base path (not root /)"
    - "RDKit.js loads from unpkg CDN in production (not /node_modules/ local path)"
    - "GitHub Actions workflow builds and deploys to GitHub Pages on push to main"
    - "Dev server still works locally with npm run dev"
  artifacts:
    - path: "vite.config.ts"
      provides: "Vite config with base path for GitHub Pages"
      contains: "base.*webfaulon"
    - path: "index.html"
      provides: "HTML with CDN-based RDKit script tag"
      contains: "unpkg.com/@rdkit/rdkit"
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions workflow for Pages deployment"
      contains: "actions/deploy-pages"
  key_links:
    - from: "vite.config.ts"
      to: "dist/index.html"
      via: "Vite build base path"
      pattern: "base.*webfaulon"
    - from: ".github/workflows/deploy.yml"
      to: "dist/"
      via: "npm run build + upload artifact"
      pattern: "npm run build"
---

<objective>
Configure Vite for GitHub Pages deployment and create the GitHub Actions workflow.

Purpose: Make the app accessible at https://steinbeck.github.io/webfaulon/ via automated deployment.
Output: Working build config with correct base path, CDN-based RDKit loading, and CI/CD workflow.
</objective>

<execution_context>
@/Users/steinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/steinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@vite.config.ts
@index.html
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vite base path and fix RDKit script tag for production</name>
  <files>vite.config.ts, index.html</files>
  <action>
1. In vite.config.ts, add `base: '/webfaulon/'` to the defineConfig object. This ensures all asset paths in the production build use the correct subpath for GitHub Pages (e.g., `/webfaulon/assets/index-xxx.js` instead of `/assets/index-xxx.js`).

2. In index.html, replace the RDKit script tag:
   FROM: `<script src="/node_modules/@rdkit/rdkit/dist/RDKit_minimal.js"></script>`
   TO: `<script src="https://unpkg.com/@rdkit/rdkit@2025.3.4-1.0.0/dist/RDKit_minimal.js"></script>`

   This is critical because /node_modules/ does not exist in the production deployment. The unpkg CDN serves the exact same file from the npm package. Pin the version to match package.json (2025.3.4-1.0.0).

3. Verify the dev server still works after changes: `npm run dev` should still load RDKit from CDN (the local node_modules path was only used by the script tag, not by Vite bundling). Verify by running `npm run build` and inspecting dist/index.html to confirm:
   - Asset script src starts with `/webfaulon/assets/`
   - RDKit script src is the unpkg URL
  </action>
  <verify>
Run `npm run build` and check dist/index.html:
- `grep 'src="/webfaulon/assets/' dist/index.html` finds the main JS bundle
- `grep 'unpkg.com/@rdkit/rdkit' dist/index.html` finds the RDKit CDN script
- `grep 'node_modules' dist/index.html` returns NO matches (old local path gone)
  </verify>
  <done>
Production build generates correct asset paths under /webfaulon/ base and loads RDKit from unpkg CDN. No references to /node_modules/ remain in dist output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GitHub Actions workflow for Pages deployment</name>
  <files>.github/workflows/deploy.yml</files>
  <action>
Create `.github/workflows/deploy.yml` with a workflow that:

1. **Trigger:** On push to `main` branch only.
2. **Permissions:** `contents: read`, `pages: write`, `id-token: write` (required for Pages deployment).
3. **Concurrency:** Use `concurrency` group `pages` with `cancel-in-progress: false` to avoid partial deployments.
4. **Job: build-and-deploy** running on `ubuntu-latest`:
   - Checkout code
   - Setup Node.js 20 with npm cache
   - `npm ci` to install dependencies
   - `npm run build` to produce dist/
   - Use `actions/configure-pages@v4`
   - Use `actions/upload-pages-artifact@v3` with `path: './dist'`
   - Use `actions/deploy-pages@v4`

5. **Environment:** Set `environment: github-pages` with `url: ${{ steps.deployment.outputs.page_url }}` on the deploy step.

Use the official GitHub Pages deployment pattern (not the older gh-pages branch approach). This is the "GitHub Actions" source type for Pages.

Note: The user will need to enable GitHub Pages in the repo settings (Settings > Pages > Source: GitHub Actions). Add a comment at the top of the workflow file noting this.
  </action>
  <verify>
Run `cat .github/workflows/deploy.yml` and confirm:
- Triggers on push to main
- Has pages permissions (pages: write, id-token: write)
- Runs npm ci, npm run build
- Uses actions/upload-pages-artifact with path: './dist'
- Uses actions/deploy-pages
- YAML is valid: `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/deploy.yml'))"`
  </verify>
  <done>
GitHub Actions workflow file exists and is valid YAML. When pushed to main with Pages enabled in repo settings, it will automatically build and deploy the app.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without errors
2. `dist/index.html` contains `/webfaulon/assets/` paths (not `/assets/`)
3. `dist/index.html` contains unpkg CDN URL for RDKit (not /node_modules/)
4. `.github/workflows/deploy.yml` is valid YAML with correct Pages deployment steps
5. `npm run dev` still works locally (dev server unaffected by base path â€” Vite handles this)
</verification>

<success_criteria>
- Vite build produces assets with /webfaulon/ base path
- RDKit loads from CDN in production
- GitHub Actions workflow is ready to deploy on push
- Local development workflow unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-add-readme-and-github-pages-deployment/03.1-01-SUMMARY.md`
</output>
