<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebFaulon - Constitutional Isomer Explorer</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        font-size: 16px;
        line-height: 1.5;
        color: #333;
        background: #f5f5f5;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      h1 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #1a1a1a;
      }

      h2 {
        font-size: 20px;
        margin-top: 30px;
        margin-bottom: 15px;
        color: #2a2a2a;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 5px;
      }

      h3 {
        font-size: 18px;
        margin-top: 20px;
        margin-bottom: 10px;
        color: #3a3a3a;
      }

      section {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 5px;
        color: #555;
      }

      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.2s;
      }

      input[type="text"]:focus,
      input[type="number"]:focus,
      select:focus {
        outline: none;
        border-color: #4a90e2;
      }

      input[type="text"]:disabled,
      input[type="number"]:disabled,
      select:disabled {
        background: #f0f0f0;
        cursor: not-allowed;
      }

      .input-error {
        border-color: #e74c3c !important;
      }

      .error-text {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
      }

      .valid-text {
        color: #27ae60;
        font-size: 14px;
        margin-top: 5px;
      }

      .hint {
        color: #777;
        font-size: 14px;
        margin-top: 5px;
      }

      .param-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }

      .controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      button {
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-primary {
        background: #4a90e2;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #357abd;
      }

      button:not(.btn-primary) {
        background: #e0e0e0;
        color: #333;
      }

      button:not(.btn-primary):hover:not(:disabled) {
        background: #d0d0d0;
      }

      .progress-bar {
        width: 100%;
        height: 30px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4a90e2, #357abd);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
      }

      .subtitle {
        color: #666;
        font-size: 14px;
        margin-bottom: 20px;
      }

      @media (max-width: 600px) {
        .param-grid {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
        }

        button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" x-data="app">
      <h1>WebFaulon</h1>
      <p class="subtitle">Constitutional Isomer Explorer - Simulated Annealing Visualization</p>

      <!-- Formula Input Section -->
      <section>
        <h2>Molecular Formula</h2>

        <!-- Preset selector -->
        <div style="margin-bottom: 20px;">
          <label>Quick Start:</label>
          <select x-model="selectedPreset" @change="selectPreset($event.target.value)">
            <option value="">-- Choose a molecule --</option>
            <template x-for="(preset, index) in presets" :key="index">
              <option :value="index" x-text="preset.name + ' (' + preset.formula + ')'"></option>
            </template>
          </select>
          <p x-show="selectedPreset !== null && presets[selectedPreset]" x-text="selectedPreset !== null && presets[selectedPreset] ? presets[selectedPreset].description : ''" class="hint"></p>
        </div>

        <!-- Manual formula input -->
        <div>
          <label>Or enter formula:</label>
          <input type="text"
            x-model="formula"
            @input.debounce.300ms="validateInput()"
            placeholder="e.g., C6H14"
            :class="{ 'input-error': !validation.valid && formula.length > 0 }"
            :disabled="state !== 'idle'"
          >
          <p x-show="!validation.valid && formula.length > 0"
             x-text="validation.error"
             class="error-text"></p>
          <p x-show="validation.valid" class="valid-text">Formula valid</p>
        </div>
      </section>

      <!-- SA Parameters Section -->
      <section>
        <h2>SA Parameters</h2>

        <div class="param-grid">
          <div>
            <label>Initial Temperature (kT):</label>
            <input type="number" x-model.number="initialTemp" min="1" max="1000" step="10" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Cooling Schedule (k):</label>
            <select x-model.number="coolingScheduleK" :disabled="state !== 'idle'">
              <option value="0">f0 - Constant temperature</option>
              <option value="1">f1 - Linear cooling</option>
              <option value="4">f4 - Moderate decay</option>
              <option value="8">f8 - Fast decay (recommended)</option>
              <option value="16">f16 - Very fast decay</option>
              <option value="32">f32 - Extreme decay</option>
            </select>
          </div>

          <div>
            <label>Steps per Cycle:</label>
            <input type="number" x-model.number="stepsPerCycle" min="10" max="5000" step="50" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Number of Cycles:</label>
            <input type="number" x-model.number="numCycles" min="1" max="20" step="1" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Optimization:</label>
            <select x-model="optimizationMode" :disabled="state !== 'idle'">
              <option value="MINIMIZE">Minimize Wiener Index</option>
              <option value="MAXIMIZE">Maximize Wiener Index</option>
            </select>
          </div>
        </div>

        <p class="hint">Total steps: <span x-text="totalSteps"></span></p>
      </section>

      <!-- Controls Section -->
      <section>
        <h2>Execution</h2>
        <div class="controls">
          <button @click="start()" :disabled="!canStart" class="btn-primary">Start</button>
          <button @click="pause()" :disabled="!canPause">Pause</button>
          <button @click="resume()" :disabled="!canResume">Resume</button>
          <button @click="reset()" :disabled="state === 'idle'">Reset</button>
        </div>

        <!-- Progress display -->
        <div x-show="progress">
          <div class="progress-bar">
            <div class="progress-fill" :style="`width: ${progressPercent}%`"></div>
          </div>
          <p>
            Step <span x-text="progress?.step || 0"></span> / <span x-text="progress?.totalSteps || 0"></span>
            | Current: <span x-text="progress?.currentEnergy || '-'"></span>
            | Best: <span x-text="progress?.bestEnergy || '-'"></span>
            | Temp: <span x-text="progress?.temperature?.toFixed(2) || '-'"></span>
          </p>
        </div>

        <!-- Results display -->
        <div x-show="state === 'complete' && result">
          <h3>Results</h3>
          <p>Best Wiener Index: <strong x-text="result?.bestEnergy"></strong></p>
          <p>Initial Wiener Index: <span x-text="result?.initialEnergy"></span></p>
          <p>Accepted: <span x-text="result?.acceptedMoves"></span>
             | Rejected: <span x-text="result?.rejectedMoves"></span>
             | Invalid: <span x-text="result?.invalidMoves"></span></p>
          <p>Acceptance Ratio: <span x-text="result ? (result.acceptanceRatio * 100).toFixed(1) + '%' : '-'"></span></p>
        </div>
      </section>

      <!-- RDKit Status -->
      <section>
        <p x-show="rdkitReady" class="valid-text">RDKit.js WASM loaded</p>
        <p x-show="rdkitError" x-text="'RDKit error: ' + rdkitError" class="error-text"></p>
        <p x-show="!rdkitReady && !rdkitError" class="hint">Loading RDKit.js WASM...</p>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
