<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebFaulon - Constitutional Isomer Explorer</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        font-size: 16px; /* NEVER change - accessibility baseline */
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        font-size: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
        line-height: 1.5;
        color: #333;
        background: #f9fafb;
        padding: clamp(1rem, 2vw, 2rem);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: #ffffff;
        padding: clamp(1.5rem, 3vw, 2.5rem);
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      h1 {
        font-size: clamp(1.75rem, 1.5rem + 1vw, 2.5rem);
        margin-bottom: 0.5rem;
        color: #1a1a1a;
      }

      h2 {
        font-size: clamp(1.25rem, 1rem + 0.75vw, 1.75rem);
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        color: #2a2a2a;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 0.5rem;
      }

      h3 {
        font-size: clamp(1.125rem, 1rem + 0.5vw, 1.375rem);
        margin-top: 1.25rem;
        margin-bottom: 0.75rem;
        color: #3a3a3a;
      }

      section {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.375rem;
        color: #555;
        font-size: 0.9375rem;
      }

      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 0.625rem;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.2s;
        min-height: 44px; /* Accessibility: touch target */
      }

      input[type="text"]:focus,
      input[type="number"]:focus,
      select:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
        border-color: #3b82f6;
      }

      input[type="text"]:disabled,
      input[type="number"]:disabled,
      select:disabled {
        background: #f0f0f0;
        cursor: not-allowed;
      }

      .input-error {
        border-color: #ef4444 !important;
      }

      .error-text {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.375rem;
      }

      .valid-text {
        color: #22c55e;
        font-size: 0.875rem;
        margin-top: 0.375rem;
      }

      .hint {
        color: #6b7280;
        font-size: 0.875rem;
        margin-top: 0.375rem;
      }

      .subtitle {
        color: #6b7280;
        font-size: clamp(0.875rem, 0.825rem + 0.25vw, 1rem);
        margin-bottom: 1.5rem;
      }

      .param-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      @media (min-width: 768px) {
        .param-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .controls {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
      }

      button {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        min-height: 44px; /* Accessibility: touch target */
        flex: 1 1 auto;
      }

      @media (min-width: 768px) {
        .controls {
          flex-wrap: nowrap;
        }
        button {
          flex: 0 1 auto;
        }
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      button:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
      }

      .btn-primary {
        background: #3b82f6;
        color: white;
      }

      .btn-primary:hover:not(:disabled) {
        background: #2563eb;
      }

      button:not(.btn-primary) {
        background: #e5e7eb;
        color: #1a1a1a;
      }

      button:not(.btn-primary):hover:not(:disabled) {
        background: #d1d5db;
      }

      .progress-bar {
        width: 100%;
        height: 1.875rem;
        background: #e5e7eb;
        border-radius: 0.25rem;
        overflow: hidden;
        margin-bottom: 0.75rem;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #2563eb);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
      }

      /* Algorithm State Panel */
      .algo-state {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      @media (min-width: 768px) {
        .algo-state {
          grid-template-columns: 1fr 1fr;
        }
      }

      .stat-item {
        display: flex;
        flex-direction: column;
      }

      .stat-label {
        font-size: 0.8125rem;
        color: #6b7280;
        font-weight: 500;
        margin-bottom: 0.25rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .stat-value {
        font-size: clamp(1.125rem, 1rem + 0.5vw, 1.375rem);
        color: #1a1a1a;
        font-weight: 600;
      }

      .stat-value.highlight {
        font-size: clamp(1.25rem, 1.125rem + 0.5vw, 1.5rem);
        color: #3b82f6;
      }

      /* Visualization Panel */
      .viz-section {
        margin-top: 1.5rem;
      }

      .viz-panel {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }

      @media (min-width: 900px) {
        .viz-panel {
          grid-template-columns: 60% 40%;
        }
      }

      .chart-container {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 1rem;
      }

      .chart-container h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1rem;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .chart-canvas-wrapper {
        position: relative;
        width: 100%;
        aspect-ratio: 2.5;
      }

      #wiener-chart {
        width: 100% !important;
        height: 100% !important;
      }

      .molecule-container {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
      }

      .molecule-container h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1rem;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .molecule-canvas-wrapper {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 250px;
        max-height: 400px;
      }

      #molecule-display {
        max-width: 100%;
        min-height: 250px;
      }

      .smiles-display {
        margin-top: 1rem;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 4px;
        border: 1px solid #e5e7eb;
      }

      .smiles-display label {
        font-size: 0.75rem;
        color: #6b7280;
        margin-bottom: 0.25rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
      }

      .smiles-display code {
        display: block;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 0.875rem;
        color: #1a1a1a;
        word-break: break-all;
        margin-top: 0.25rem;
      }

      /* Results section */
      .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      @media (min-width: 768px) {
        .results-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .result-item {
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 4px;
        border: 1px solid #e5e7eb;
      }

      .result-item strong {
        font-size: 1.25rem;
        color: #3b82f6;
      }

      /* Accessibility */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
      }

      @media (prefers-contrast: high) {
        body {
          color: #000;
          background: #fff;
        }
        .container {
          border: 2px solid #000;
        }
        button {
          border: 2px solid #000;
        }
      }

      /* Mobile adjustments */
      @media (max-width: 767px) {
        .controls {
          flex-direction: column;
        }
        button {
          width: 100%;
        }
      }

      /* Projection optimizations */
      @media (min-width: 1366px) {
        .container {
          max-width: 1200px;
        }
        .chart-canvas-wrapper {
          aspect-ratio: 2.8;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" x-data="app">
      <!-- Header -->
      <h1>WebFaulon</h1>
      <p class="subtitle">Constitutional Isomer Explorer - Simulated Annealing Visualization</p>

      <!-- Formula Input Section -->
      <section>
        <h2>Molecular Formula</h2>

        <!-- Preset selector -->
        <div style="margin-bottom: 1.25rem;">
          <label>Quick Start:</label>
          <select x-model="selectedPreset" @change="selectPreset($event.target.value)">
            <option value="">-- Choose a molecule --</option>
            <template x-for="(preset, index) in presets" :key="index">
              <option :value="index" x-text="preset.name + ' (' + preset.formula + ')'"></option>
            </template>
          </select>
          <p x-show="selectedPreset !== null && presets[selectedPreset]" x-text="selectedPreset !== null && presets[selectedPreset] ? presets[selectedPreset].description : ''" class="hint"></p>
        </div>

        <!-- Manual formula input -->
        <div>
          <label>Or enter formula:</label>
          <input type="text"
            x-model="formula"
            @input.debounce.300ms="validateInput()"
            placeholder="e.g., C6H14"
            :class="{ 'input-error': !validation.valid && formula.length > 0 }"
            :disabled="state !== 'idle'"
          >
          <p x-show="!validation.valid && formula.length > 0"
             x-text="validation.error"
             class="error-text"></p>
          <p x-show="validation.valid" class="valid-text">Formula valid</p>
        </div>
      </section>

      <!-- SA Parameters Section -->
      <section>
        <h2>SA Parameters</h2>

        <div class="param-grid">
          <div>
            <label>Initial Temperature (kT):</label>
            <input type="number" x-model.number="initialTemp" min="1" max="1000" step="10" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Cooling Schedule (k):</label>
            <select x-model.number="coolingScheduleK" :disabled="state !== 'idle'">
              <option value="0">f0 - Constant temperature</option>
              <option value="1">f1 - Linear cooling</option>
              <option value="4">f4 - Moderate decay</option>
              <option value="8">f8 - Fast decay (recommended)</option>
              <option value="16">f16 - Very fast decay</option>
              <option value="32">f32 - Extreme decay</option>
            </select>
          </div>

          <div>
            <label>Steps per Cycle:</label>
            <input type="number" x-model.number="stepsPerCycle" min="10" max="5000" step="50" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Number of Cycles:</label>
            <input type="number" x-model.number="numCycles" min="1" max="20" step="1" :disabled="state !== 'idle'">
          </div>

          <div>
            <label>Optimization:</label>
            <select x-model="optimizationMode" :disabled="state !== 'idle'">
              <option value="MINIMIZE">Minimize Wiener Index</option>
              <option value="MAXIMIZE">Maximize Wiener Index</option>
            </select>
          </div>
        </div>

        <p class="hint">Total steps: <span x-text="totalSteps"></span></p>
      </section>

      <!-- Controls Section -->
      <section>
        <h2>Execution</h2>
        <div class="controls">
          <button @click="start()" :disabled="!canStart" class="btn-primary">Start</button>
          <button @click="pause()" :disabled="!canPause">Pause</button>
          <button @click="resume()" :disabled="!canResume">Resume</button>
          <button @click="reset()" :disabled="state === 'idle'">Reset</button>
        </div>

        <!-- Progress bar -->
        <div x-show="progress">
          <div class="progress-bar">
            <div class="progress-fill" :style="`width: ${progressPercent}%`">
              <span x-text="`${Math.round(progressPercent)}%`"></span>
            </div>
          </div>
        </div>
      </section>

      <!-- Visualization Section (shown when running or complete) -->
      <section x-show="progress" class="viz-section">
        <h2>Live Visualization</h2>

        <!-- Algorithm State Panel -->
        <div class="algo-state">
          <div class="stat-item">
            <span class="stat-label">Current Step</span>
            <span class="stat-value">
              <span x-text="progress?.step || 0"></span> / <span x-text="progress?.total_steps || 0"></span>
            </span>
          </div>

          <div class="stat-item">
            <span class="stat-label">Temperature</span>
            <span class="stat-value" x-text="progress?.temperature?.toFixed(2) || '-'"></span>
          </div>

          <div class="stat-item">
            <span class="stat-label">Current Wiener Index</span>
            <span class="stat-value" x-text="progress?.current_energy || '-'"></span>
          </div>

          <div class="stat-item">
            <span class="stat-label">Best Wiener Index</span>
            <span class="stat-value highlight" x-text="progress?.best_energy || '-'"></span>
          </div>
        </div>

        <!-- Visualization Panel: Chart + Molecule -->
        <div class="viz-panel">
          <!-- Wiener Index Chart -->
          <div class="chart-container">
            <h3>Wiener Index Timeline</h3>
            <div class="chart-canvas-wrapper">
              <canvas id="wiener-chart"></canvas>
            </div>
          </div>

          <!-- Molecular Structure -->
          <div class="molecule-container">
            <h3>Best Structure</h3>
            <div class="molecule-canvas-wrapper">
              <div id="molecule-display" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;"></div>
            </div>
            <div class="smiles-display" x-show="bestSMILES">
              <label>SMILES:</label>
              <code x-text="bestSMILES"></code>
            </div>
          </div>
        </div>
      </section>

      <!-- Results Section (shown when complete) -->
      <section x-show="state === 'complete' && result">
        <h2>Results</h2>
        <div class="results-grid">
          <div class="result-item">
            <p>Best Wiener Index: <strong x-text="result?.best_energy"></strong></p>
          </div>
          <div class="result-item">
            <p>Accepted Moves: <span x-text="result?.accepted_moves"></span></p>
          </div>
          <div class="result-item">
            <p>Rejected Moves: <span x-text="result?.rejected_moves"></span></p>
          </div>
          <div class="result-item">
            <p>Invalid Moves: <span x-text="result?.invalid_moves"></span></p>
          </div>
          <div class="result-item">
            <p>Disconnected Moves: <span x-text="result?.disconnected_moves"></span></p>
          </div>
          <div class="result-item">
            <p>Acceptance Ratio: <span x-text="result ? (result.accepted_moves / (result.accepted_moves + result.rejected_moves) * 100).toFixed(1) + '%' : '-'"></span></p>
          </div>
        </div>
      </section>

      <!-- Backend Status (footer) -->
      <section style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
        <p x-show="backendError" x-text="'Backend error: ' + backendError" class="error-text"></p>
        <p x-show="!backendError" class="hint">Backend: localhost:8000</p>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
